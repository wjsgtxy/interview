RDMA 论文：

Ophirmaor, How To Run RoCE and TCP over L2 Enabled with PFC. 
https://community.mellanox.comldocsIDOC-1415 



Bonwick, Jeff. "The SI ab Allocator: An Object-Caching Kernel Memory 
Allocator." USENJX Vol. 16. 1994. 



Stuedi, Patrick, et al. "Wimpy Nodes with 10GbE: Leveraging OneSided Operations in Soft-RDMA to Boost Memcached." ATC, 2012







**非统一内存访问（NUMA）**是一种用于多处理器的[电脑](https://baike.baidu.com/item/%E7%94%B5%E8%84%91)内存体设计，内存访问时间取决于处理器的内存位置。 在NUMA下，处理器访问它自己的本地存储器的速度比非本地存储器（存储器的地方到另一个处理器之间共享的处理器或存储器）快一些。





### **4 并行计算机的内存架构**

**4.1 共享内存**

**一般特征：** 共享内存的并行计算机虽然也分很多种，但是通常而言，它们都可以让所有处理器以全局寻址的方式访问所有的内存空间。多个处理器可以独立地操作，但是它们共享同一片内存。一个处理器对内存地址的改变对其它处理器来说是可见的。根据内存访问时间，可以将已有的共享内存机器分为**统一内存存取**和**非统一内存存取**两种类型。

**统一内存存取(Uniform Memory Access)：** 目前更多地被称为*对称多处理器机器(Symmetric Multiprocessor (SMP))*，每个处理器都是相同的，并且其对内存的存取和存取之间都是无差别的。有时候也会被称为CC-UMA (Cache coherent - UMA)。缓存想干意味着如果一个处理器更新共享内存中的位置，则所有其它处理器都会了解该更新。缓存一致性是在硬件级别上实现的。

![这里写图片描述](rdma论文.assets/aHR0cHM6Ly9jb21wdXRpbmcubGxubC5nb3YvdHV0b3JpYWxzL3BhcmFsbGVsX2NvbXAvaW1hZ2VzL3NoYXJlZF9tZW0uZ2lm)

**非统一内存存取(Non-Uniform Memory Access)：** 通常由两个或者多个物理上相连的SMP。一个SMP可以存取其它SMP上的内存。不是所有处理器对所有内存都具有相同的存取或者存取时间。通过连接而进行内存存取速度会更慢一些。如果缓存相缓存想干的特性在这里仍然被保持，那么也可以被称为CC-NUMA。

![这里写图片描述](rdma论文.assets/aHR0cHM6Ly9jb21wdXRpbmcubGxubC5nb3YvdHV0b3JpYWxzL3BhcmFsbGVsX2NvbXAvaW1hZ2VzL251bWEuZ2lm)

**优点：**全局地址空间提供了一种用户友好的编程方式，并且由于内存与CPU的阶级程度，使得任务之间的数据共享既快速又统一。

**缺点：**最大的缺点是内存和CPU之间缺少较好的可扩展性。增加更多的CPU意味着更加共享内存和缓存想干系统上的存取流量，从而几何级别地增加缓存/内存管理的工作量。同时也增加了程序员的责任，因为他需要确保全局内存“正确”的访问以及同步。

**4.2 分布式内存**

**一般概念：** 分布式内存架构也可以分为很多种，但是它们仍然有一些共同特征。分布式内存结构需要通讯网络，将不同的内存连接起来。一般而言，处理器会有它们所对应的内存。一个处理器所对应的内存地址不会映射到其它处理器上，所以在这种分布式内存架构中，不存在各个处理器所共享的全局内存地址。
![这里写图片描述](rdma论文.assets/aHR0cHM6Ly9jb21wdXRpbmcubGxubC5nb3YvdHV0b3JpYWxzL3BhcmFsbGVsX2NvbXAvaW1hZ2VzL2Rpc3RyaWJ1dGVkX21lbS5naWY)

由于每个处理器具有它所对应的局部内存，所以它们可以独立进行操作。一个本地内存上所发生的变化并不会被其它处理器所知晓。因此，缓存想干的概念在分布式内存架构中并不存在。

如果一个处理器需要对其它处理器上的数据进行存取，那么往往程序员需要明确地定义数据通讯的时间和方式，任务之间的同步因此就成为程序员的职责。尽管分布式内存架构中用于数据传输的网络结构可以像以太网一样简单，但在实践中它们的变化往往也很大。

**优点：** 1）内存可以随着处理器的数量而扩展，增加处理器的数量的同时，内存的大小也在成比例地增加；2）每个处理器可以快速地访问自己的内存而不会受到干扰，并且没有维护全局告诉缓存一致性所带来的开销；3）成本效益：可以使用现有的处理器和网络。

**缺点：** 1）程序员需要负责处理器之间数据通讯相关的许多细节；2）将基于全局内存的现有数据结构映射到该分布式内存组织可能会存在困难；3）非均匀的内存访问时间——驻留在远程结点上的数据比本地结点上的数据需要长的多的访问时间。

**4.3 混合分布式-共享内存**

**一般概念：** 目前世界上最大和最快的并行计算机往往同时具有分布式和共享式的内存架构。共享式内存架构可以是共线内存机器或者图形处理单元(GPU)。分布式内存组件可以是由多个共享内存/GPU连接而成的系统。每个结点只知道自己的内存，不知道网络上其它结点的内存。因此，需要在不同的机器上通过网络进行数据通讯。

从目前的趋势来看，这种混合式的内存架构将长期占有主导地位，并且成为高端计算在可见的未来中的最好选择。

**优缺点：** 1）继承了共享式内存和分布式内存的优缺点；2）优点之一是可扩展性；3）缺点之一是编程的复杂性。





单机多核的计算有多种实现方法，包括手动创立进程，使用OpenMP或者MPI。

还有一种叫 OpenSHMEM （PGAS的一种），这几种的区别就是，OpenMP是共享内存，通过内存联系，MPI是分布式内存，利用消息联络，而PGAS就是利用分布式内存

然后让你用着像共享内存，他们之间是可以混合编程也可以单独编程，PGAS貌似依赖机器架构多一点，有一点点类似CUDA，不同厂家支持的还不一样，可以针对某一台超算进行优化。

注意MPI的一个开源实现叫做OpenMPI，不要和OpenMP混淆。







## 基于RDMA的分布式数据库内存存储系统-梁戈

重点

基于他们实验室的分布式内存数据库goldfish

设计了一套兼容RDMA和tcp的底层网络库

实用了gpu加速

基于rdma，设计了分布式内存数据库存储系统

针对热点问题，提出了一种动态负载均衡的数据迁移算法



也做了报文测试，结论是要使用大报文



## Windows下支持RDMA的数据卡驱动设计与实现_曲宏欣

设计windows驱动程序的

低时延网络技术分析可以借鉴

图片丰富，可以借鉴

自己管理共享缓冲区内存，用了伙伴算法



## 基于RDMA的共享缓冲区分...式数据库事务处理设计与实现_魏寒 

#### 这篇文章重要，要多看看！！！

基于openGause



#### 实现了一个定制化的基于rdma的远程过程调用rpc框架

计算节点和存储节点之间，以及计算节点和GTM(全局事务管理器)之间的通信，使用了基于rdma的rpc框架

share disk 架构

multi-master架构



#### 共享缓冲区使用RDMA优化

**RMDA带宽测试可以借鉴**

通过上面测个测试，可以导出-->要把rdma请求合并



#### 事务控制优化

使用rdma优化事务控制，这个方向可以借鉴！！！

他优化的是计算节点和全局事务管理器之间的通信！

消息批处理优化，可以降低rdma通信次数

他还使用了非易失性内存PM来优化



测试使用了TPC-c

包含了吞吐量测试和延迟性测试！



## 基于RDMA的键值存储系统传输优化与容错_蒋源

可参考

> 针对RDMA传输性能未能充分挖掘的问题，本文采用更低时延的单边RDMA write 语义重新设计内存键值存储系统的 GET 指令与 PUT 指令，使得一次往返传输，即可完成数据访问的 GET 指令，从而极大地降低传输时延，并释放客户端 CPU 开销。针对单边 write 操作旁路远端内核带来的远端读写竞争问题，提出了在服务器端 RDMA 内存中引入监听线程与优先队列，将多客户端并行指令转成轮询式串行处理的解决方案



还用了什么纠删码，看不太懂



> 近年来，基于 RDMA 这种低时延、高吞吐量和内核旁路优势的通信技术开
> 始被引入到内存键值存储系统中。早期的研究工作仅仅使用 RDMA 双边语义
> send/recv 操作来替换传统 TCP/IP 中的 socket 抽象层实现传输上的加速[22]，后
> 续开始出现使用高性能单边语义和双边语义组合的方式实现分布式环境下传输
> 性能的提升[26][30][31]。然而，这些都不能充分挖掘 RDMA 语义中的高传输特
> 性。本章将结合最快单边语义 RDMA write 操作，重新设计键值存储系统中 GET
> 与 PUT 指令，避免多次往返传输，同时引入消息队列来处理单边操作带来的分
> 布式读写竞争问题，解放客户端内核，提升应用层用户体验。

**可以参考，毕竟gmdb也是 kv数据库**



## 基于远程直接内存访问的零拷...程过程调用框架的设计与实现_周华平

可参考

3个工作：

基于通用内存分配器mimalloc，实现了基于rdma的 内存管理器 rmalloc

**基于通用的序列化库 flatbuffers进行修改，实现了零拷贝序列化机制**

使用rdma自己研究了一个 rpc框架 zrpc



## 基于RDMA的分布式内存文件系统的设计与实现_李江川 

使用nvm，rdma构建了分布式文件系统

**可参考 他写的 RDMA技术背景资料在各个系统中的应用**



## 基于RDMA的网络流量分布式缓存技术研究_赵立友 

可参考他写的背景资料 rdma的应用 包括了阿里云使用rdma的网络和微软使用的网络

参考写的 rdma用户操作接口，封装了很多接口，屏蔽rdma



## 数据中心RDMA网络资源复用与应用加速研究_邱昊楠

南京大学的，参加rdma比赛获奖，论文水平应该还不错，多看看参考

参考文献可以看看

都是比较实用的那种



sata 100us

tcp 100us







**进程间通信**

IPC（Inter-[Process](https://baike.baidu.com/item/Process/1170280)[ Communication](https://baike.baidu.com/item/%20Communication/20394231)，[进程间通信](https://baike.baidu.com/item/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/1235923)）。进程间通信是指两个进程的数据之间产生交互

IPC(Inter-Process Communication)进程间通信，提供了各种进程间通信的方法。在Linux C编程中有几种方法

(1) 半双工Unix管道

(2) FIFOs(命名管道)

(3) 消息队列

(4) 信号量

(5) 共享内存

(6) 网络Socket



命名管道：https://blog.csdn.net/lianghe_work/article/details/47722175



共享内存：https://zhuanlan.zhihu.com/p/407140461

共享内存 https://zhuanlan.zhihu.com/p/260418383

共享内存编程方法：https://blog.csdn.net/a1912157861/article/details/122918087





```bash
root@xyvm1:~# ipcs -m

------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status

```

