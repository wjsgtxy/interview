# VirtualBox安装Ubuntu20

首先vitualbox安装ubuntu20.04server版



## 复制虚拟机

virtualbox复制虚拟机教程：https://blog.51cto.com/fyduan/1727834

复制之后修改主机名称：https://blog.csdn.net/dengjin20104042056/article/details/80462511

永久修改：

```
vi /etc/hostname
reboot
```



## VirtualBox中的网络连接方式详解：非常清楚！！！

https://www.cnblogs.com/tmlee/p/9723764.html

上面这篇文章弄清楚了，下面的互联互通就都清楚了，这篇文章感觉是翻译的这篇：

https://technology.amis.nl/platform/virtualization-and-oracle-vm/virtualbox-networking-explained/



下面这篇英文的文章，讲的更加详细清楚！！！

https://www.nakivo.com/blog/virtualbox-network-setting-guide/





## 主机直接访问虚拟机

虚拟机网卡使用网络地址转换（NAT)，主机通过配置端口转发，就可以在ssh中连接127.0.0.1 端口2222（自定义的）连接上虚拟机了

https://www.cnblogs.com/wangkongming/p/4101937.html

在下面设置了enp0s8（Host-Only模式产生的网卡）之后，可以通过那个网卡的IP使用ssh连接虚拟机



## 让虚拟机之间互通以及访问外网

互通配置：两个网卡
https://zhuanlan.zhihu.com/p/40405167

配置网络及ssh登录

https://blog.csdn.net/u014756245/article/details/120076982



### 总结记录：

#### 设置ubuntu网卡命令

```
cd /etc/netplan
sudo vi 00-installer-config.yaml
```



Netplan configuration examples: （netplan的设置说明）

https://netplan.io/examples/

```
# This is the network config written by 'subiquity'
network:
  ethernets:
    enp0s3:
      dhcp4: true
      dhcp4-overrides:
          route-metric: 100
    enp0s8:
      dhcp4: true
      dhcp4-overrides:
          route-metric: 200
  version: 2
```

修改yaml配置文件之后要应用

```
sudo netplan apply
```



直接设置某个网卡的ip地址：(这种方式重启之后设置的ip就没了，临时可以用一下)

```
sudo ifconfig enp0s8 192.168.56.3 netmask 255.255.255.0
```

查看网卡默认网关的方法：

```
route -n
```

![image-20220106155613795](VirtualBox安装Ubuntu20.assets/image-20220106155613795.png)



查看网卡的信息还可以使用：

```
ip ro
```

![image-20220106160717919](VirtualBox安装Ubuntu20.assets/image-20220106160717919.png)



### ubuntu禁用ipv6

使用ping的时候，发现icmp传输的是ipv6的协议：

![image-20220107112333227](VirtualBox安装Ubuntu20.assets/image-20220107112333227.png)

直接编辑 /etc/sysctl.conf文件，添加一行：

```shell
sudo vi /etc/sysctl.conf
net.ipv6.conf.all.disable_ipv6 = 1

sudo ifconfig enp0s8 down
sudo ifconfig enp0s8 up
```

*试了，这种方式没用，不知道为什么*



还可以在grub启动引导的时候传参给内核：https://blog.csdn.net/bingjianIT/article/details/81836472

```
sudo vi /etc/default/grub
# 找到 GRUB_CMDLINE_LINUX 添加 ipv6.disable=1
GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0 console=ttyS0,115200 console=tty0 panic=5 crashkernel=auto ipv6.disable=1"

# 注意，添加ipv6 disable之后，还需要更新/boot/grub/grub.cfg文件才可以，这个文件里面有提示：

# DO NOT EDIT THIS FILE
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub

sudo update-grub
```

~~这种方式最后还是失败了，重启网卡依然有ipv6地址~~

其实是可以的，看错了，把mac地址看成了ipv6地址，一个是ipv6，一个是ether，比较像。

![image-20220107145325405](VirtualBox安装Ubuntu20.assets/image-20220107145325405.png)



## 设置网卡混杂模式

**混杂模式**

1、指一台机器的网卡能够接收所有经过它的数据包，而不论其目的地址是否是它。

2、一般计算机网卡都工作在非混杂模式下，如果设置网卡为混杂模式需要root权限

**linux下设置**

1、设置混杂模式：ifconfig eth0 promisc

2、取消混杂模式：ifconfig eth0 -promisc

windos下通过特定的软件实现



# 安装docker

```bash
# 安装docker：
sudo apt-get install -y docker.io

# 启动docker服务：
systemctl start docker

# 设置开机启动：
systemctl enable docker

# 查看docker状态：
systemctl status docker

# 停止docker服务：
systemctl stop docker

# 查看docker版本：
docker version
```

安装之后会有这个链接 /etc/systemd/system/multi-user.target.wants/docker.service → /lib/systemd/system/docker.service

```bash
Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service → /lib/systemd/system/containerd.service.
Setting up docker.io (20.10.7-0ubuntu5~20.04.2) ...
Adding group `docker' (GID 118) ...
Done.
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /lib/systemd/system/docker.service.
Created symlink /etc/systemd/system/sockets.target.wants/docker.socket → /lib/systemd/system/docker.socket.
Setting up dnsmasq-base (2.80-1.1ubuntu1.4) ...
Setting up ubuntu-fan (0.12.13) ...
Created symlink /etc/systemd/system/multi-user.target.wants/ubuntu-fan.service → /lib/systemd/system/ubuntu-fan.service.
Processing triggers for systemd (245.4-4ubuntu3.14) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for dbus (1.12.16-2ubuntu2.1) ...
Processing triggers for libc-bin (2.31-0ubuntu9.2) ...

```



## 使用内部源作为docker仓库

```bash
vim /lib/systemd/system/docker.service

# 修改ExecStart=值里面的
--insecure-registry rnd-dockerhub.huawei.com 

# 重启docker 
systemctl daemon-reload
service docker restart

# 搜索镜像
docker search  rnd-dockerhub.huawei.com/official/
docker search  rnd-dockerhub.huawei.com/library/

rnd-dockerhub.huawei.com/official/：用于和docker hub官网的镜像进行定期同步
rnd-dockerhub.huawei.com/library/ : 为公司内源镜像库，普通用户也无权限上传个人镜像.

# 测试
pull hello-world镜像
docker pull rnd-dockerhub.huawei.com/official/hello-world 
```



## docker配置代理



检查是否配置成功

systemctl show --property=Environment docker